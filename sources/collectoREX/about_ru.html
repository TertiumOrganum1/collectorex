<html>
<head>
<title>Tertium Organum CollectoREX Help</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
  <style>
    h1{
      font-family: "Verdana";
      font-size: 18pt;
      font-weight: bold;
    }
    h2{
      font-family: "Verdana";
      font-size: 16pt;
      font-weight: bold;
    }
    h3{
      font-family: "Verdana";
      font-size: 14pt;
      font-style: italic;
      font-weight: bold;
    }
    h4{
      font-family: "Verdana";
      font-size: 12pt;
      font-weight: bold;
    }
    body,li
    {
      font-family: "Verdana";
      font-size: 10pt;
      font-weight: normal;
      text-align: justify;
    }
    p
    {
      font-family: "Verdana";
      font-size: 10pt;
      font-weight: normal;
      text-align: justify;
      text-indent: 20px
    }
    img
    {
      border: 0 none;
    }
  </style>
</head>

<body>

<h1>Tertium Organum CollectoREX: руководство пользователя</h1>
<h2>Установка</h2>
Распакуйте архив. Файл с раширением mzp - это дистрибутив утилиты. В 3dsmax выберите пункт меню MAXScript->Run script и укажите дистрибутив утилиты. 3dsmax скопирует все файлы утилиты в нужные папки.
Выберите пункт меню Custimize->Custoimize User Interface..., появится окно Custoimize User Interface. Перейдите на закладку Toolbars, в выпадающем списке Category выберите категорию Tertium Organum.
В списке ниже появится строка Tertium Organum CollectoREX (или Tertium Organum CollectoREX DEMO, если вы установили демо-версию). Перетащите ее на панель инструментов. Для того, чтобы стала видна иконка,
может потребоваться перезагрузка 3dsmax. Установка завершена.
<h2>Быстрый старт</h2>
 Основное назначение утилиты – сбор файлов, связанных с проектом, в некоторые определенные папки – для упорядочивания работы и – потенциально – для переноса сцен на другие компьютеры. Для запуска операции сбора:<br />
1. Загрузите сцену, не содержащую XRef-ссылок (работа со сценой, имеющей XRef-ссылки, несколько сложнее и описывается ниже)<br />
2. Запустите утилиту (кнопка на панели управления имеет два состояния, чтобы закрыть утилиту, надо щелкнуть по кнопке еще раз) <br />
3. Для того, чтобы видеть выводимую утилитой информацию в реальном времени (она также сохраняется в файл лога), откройте MAXScript Listener (нажмите F11 или щелкните по пункту меню MAXScript -> MAXScript Listener) <br />
4. Выберите папки сбора, опции категории <b>Affect</b> станут активны<br /> <br />
<center><img src="img/1.gif" width="243" height="290" alt="" /></center><br />   <br />
5. Нажмите кнопку Collect Resources.<br />  <br />
<center><img src="img/2.gif" width="162" height="307" alt="" /></center><br />     <br />
6. Утилита соберет все ресурсы проекта, сохранит сцену и обновит все ссылки на них в объектах сцены. В папке со сценой добавится два файла – с расширением backup (резервное сохранение файла сцены) и log (файл лога).<br />
<h2>Термины</h2>
<b>XRef-дерево</b> – текущая сцена плюс все сцены, так или иначе связанные с ней посредством XRef (XRef Scene, XRef Object, XRef Material, XRef Atmospheric). XRef-ссылки могут быть зациклены.<br />
<b>IES-файл</b> – упрощенное название файла фотометрических данных (photometric web), используемых в фотометрических источниках света.<br />
<b>Ссылки (на файлы)</b> – свойства сущностей сцены (материалов, геометрии, модификаторов и пр.) типа «FileName/String», «Bitmap», которые ссылаются на какие-либо файлы, входные относительно сцены – текстуры, шейдеры, IES-файлы и пр. Исключение в данном случае составляют XRef-ссылки. Если сцену представить графом «max-файл» - «файлы ресурсов», то ссылки на файлы будут его ребрами.<br />
<b>Папки сбора</b> – три указываемые пользователем папки для текущего проекта, куда будут собраны соответственно: файлы изображений и IES-файлы, файлы изображений HDR (из-за своих больших размеров они вынесены в отдельную категорию) и Vray mesh – файлы.<br />
<b>Дерево ссылки в сцене</b> – некоторое множество объектов, односторонне соединенных друг с другом ссылками «целое-часть», по которому можно найти ссылку на файл в сцене. Например, ссылка-свойство одной из подтекстур одной из текстур одного из материалов мультиматериала, который применен к одному из объектов, такое: объект -> мультиматериал -> материал -> текстура -> подтекстура -> имя свойства.<br />
<b>Реальный путь файла</b> – путь реально существующего файла, в противовес сохраненному в сцене пути. Когда 3dsmax не находит файл по указанному в ссылке сцены пути, он ищет этот файл в папке текущей сцены, всех ее подпапках и в системных путях и путях, заданных пользователем. Поэтому путь реально загруженного файла может не совпадать с путем, сохраненным в сцене. Когда в сцену подгружаются объекты из других сцен, картина становится еще более запутанной.<br />
<b>Проект</b> – в контексте утилиты это либо сцена с принадлежащим ей XRef-деревом. Если сцена не использует XRef-ссылки, то проектом считается сама сцена.<br />
<h2>Технические условия и рекомендации по использованию</h2>
Tertium Organum CollectoREX создан для работы со сценами, предназначенными для визуализации с помощью стандартного Scanline Renderer или VRay. С материалами Fry Renderer утилита не работает, у материалов Maxwell Renderer может извлекать информацию только о текущем слое (layer) и текущей оболочке (coating).<br />
Утилита протестирована на совместимость с 3dsmax версий: 9sp1-sp2, 2008, 2009. Работа с версией 9 без sp1 и более ранними версиями невозможна.<br />
Сетевые пути поддерживаются, главное – чтобы сетевые папки были открыты на запись.<br />
Желательно перед использованием утилиты перезагружать 3dsmax. Утилита оперирует большими массивами данных, поэтому возможны неполадки в работе сборщика мусора MAXScript. В некоторых случаях нестабильность и накапливающиеся сбои сборщика мусора MAXScript приводит к критическому сбою 3dsmax.<br />
Также рекомендуется увеличить размер Initial Heap Allocation в закладке MAXScript окна Preference Settings (пункт меню Customize->Preferences…) хотя бы до 100Мб. Это позволит утилите работать стабильней.<br />
<h2>Почему выбор за Tertium Organum CollectoREX</h2>
<ul>
<li> позволяет собирать ресурсы только выбранных типов </li>
<li> собирает ресурсы разных типов в разные папки (но может и в одну)</li>
<li> предлагает варианты действий, если копируемый файл имеет то же имя, что и файл, уже существующий в папке сбора; предлагает уменьшенные изображения и информацию для адекватного выбора варианта действия</li>
<li> при сравнении файлов с одинаковыми именами использует сравнение изображений с учетом и без учета альфа-канала (если это изображения или HDRI) и подсчет контрольной суммы (если это не изображения)</li>
<li> собирает только реально задействованные в сцене ресурсы – в обход Asset Tracking </li>
<li> по желанию может не учитывать содержимое Material Editor, не примененное к сцене, и вообще очищать его перед любой операцией</li>
<li> не учитывает ресурсы, относящиеся к Scene States</li>
<li> при сборе переписывает ВСЕ ссылки на ВСЕ собранные ресурсы так, чтобы они указывали на реальные файлы, а не только на те, которые не присутствуют в папках пользователя (User Paths)</li>
<li> имеет множество настроек, которые автоматически сохраняются вместе с каждой сценой и загружаются из нее</li>
<li> позволяет сохранить настройки в глобальные умолчания пользователя, чтобы не выставлять их каждый раз</li>
<li> позволяет выстроить workflow, основанный на периодическом сборе ресурсов и ведении трёх или менее папок сбора в полуавтоматическом режиме (файлы копируются и удаляются ненужные с помощью утилиты)</li>
<li> создает файлы резервного сохранения (один или много – инкрементное резервное сохранение) сцен, но не средствами 3dsmax (просто копирует текущий файл): сохранение средствами 3dsmax иногда приводит к сбою и потере данных </li>
<li> автоматически сохраняет сцену после операции утилиты: можно не опасаться, что по завершении операции утилиты пользователь забудет сохранить файл или произойдет сбой и данные будут потеряны</li>
<li> позволяет установить, в каких именно объектах находятся ссылки на ненайденные файлы (Missing files)</li>
<li> позволяет принудительно задать местоположение всех типов ресурсов тремя папками</li>
<li> позволяет без копирования файлов переписать все ссылки так, чтобы они ссылались на файлы с теми же именами внутри заданных папок сбора; это может понадобится при перемещении проектов на другие машины или диски</li>
<li> выдает информацию о реальном местоположении файлов, на которые ссылается сцена, и позволяет соответственно переписать все ссылки на них</li>
<li> показывает (после сбора), какие файлы внутри папок сбора не задействованы в проекте, и позволяет удалить их или перенести в локальную корзину</li>
<li> конвертирует несжатые «большие» изображения (".tif", ".tiff", ".psd", ".png", ".tga" и ".bmp") в JPEG или TGA+alpha для экономии места на диске и ускорения загрузки сцены</li>
<li> позволяет обрабатывать все файлы, связанные с текущей сценой посредством XRef-ссылок всех типов, в batch-режиме</li>
<li> обладает защитой от сбоев 3dsmax для batch-режима: в процессе обработки нескольких файлов запоминает текущее состояние, чтобы в случае сбоя 3dsmax продолжить выполнение при следующей сессии</li>
<li> подробно протоколирует свои действия в файлы лога, чтобы по завершении операции всегда можно было установить все детали; имена файлам лога даются инкрементно</li>
<li> позволяет прервать операцию на любом этапе, в том числе и операцию в batch-режиме</li>
</ul>
<h2>Функции утилиты</h2>
1. <b>Collect resources</b> – сбор всех ресурсов (а именно: изображений, изображений HDR, Vray mesh’ей, IES-файлов, файлов шейдеров), на которые ссылается текущая сцена или все XRef-дерево, в указанные папки и модификация в этих сценах ссылок на эти файлы<br />
2. <b>Unused</b> – поиск в указанных папках файлов, на которые нет ни одной ссылки в текущей сцене или во всем XRef-дереве. Найденные файлы можно удалить или перенести в «локальную корзину» - папку «$trash$», создающуюся той в папке, где найдены неиспользуемые файлы<br />
3. <b>Relink to resources roots</b> – попытка переписать все ссылки сцены или всего XRef-дерева так, чтобы они ссылались на файлы с теми же именами внутри заданных папок сбора. Если какого-то файла не найдено в указанных папках сбора, ссылка на него остается нетронутой. Эта функция нужна при «переезде» сцены или ее папок сбора на новое место<br />
4. <b>Resolve links to existing</b> – выяснение реального (а не сохраненного в ссылках) местоположения файлов, на которые ссылается сцена или все XRef-дерево, и изменение ссылок, чтобы они ссылались на реальные файлы<br />
5. <b>Missing files Identity</b> – выдача информации о том, в каких объектах сцены или Xref-дерева находятся ссылки на несуществующие файлы (Missing files), с выводом полного дерева ссылки<br />
6. <b>Convert to JPEG/TGA</b> – конвертация файлов с расширениями ".tif", ".tiff", ".psd", ".png", ".tga" и ".bmp" в файлы jpeg или tga с RLE-компрессией (если у файла присутствует альфа-канал и пользователь хочет сохранить его)<br />
<h2>Интерфейс</h2>
Интерфейс состоит из трех свитков.<br />     <br />
<table width = "100%">
<tr>
<td width = 180>&nbsp;
</td>
<td>
<h4>Свиток «TO CollectoREX»</h4>
</td>
</tr>
<tr>
<td width = 180>
<img src="img/3.gif" width="167" height="718" alt="" />
</td>
<td>
<b>Files</b> <b>with</b> <b>same</b> <b>names</b><br />
Действия с файлами, при копировании которых в папки сбора выясняется, что файл с таким именем уже присутствует<br />
<b>Ask</b> <b>even</b> <b>if</b> <b>bmps</b> <b>are</b> <b>equal</b> – выводить диалог сравнения файлов с вариантами действий «Заменить», «Использовать имеющийся» и «Переименовать», даже если изображения полностью идентичны.<br />
<b>Non</b>-<b>img</b> <b>full</b> <b>compare</b> (<b>slow</b>!) – сравнивать файлы, не являющиеся изображениями, побайтно, если контрольные суммы совпадают. Не рекомендуется использовать, если копируются большие файлы. Если помимо изображений собираются только IES-файлы, эта опция может быть использована.<br />
<b>Ask</b> <b>even</b> <b>if</b> <b>binary</b> <b>are</b> <b>equal</b> – выводить диалог сравнения файлов (не изображений), даже если они идентичны<br />
<br />
<b>Security</b><br />
Безопасность данных<br />
<b>Make</b> <b>back</b>-<b>ups</b> – создавать резервное сохранение перед каждой операцией утилиты, изменяющей файл сцены<br />
<b>Incremental</b> <b>back</b>-<b>ups</b> – при наличии файла резервного сохранения присваивать новому имя, состоящее из имени сцены, порядкового номера, и двойного расширения «max.backup»: myscene.max.backup, myscene1.max.backup, myscene2.max.backup и т.д. Если эта опция не выбрана, файл будет каждый раз перезаписываться (например, myscene.max.backup)<br />
<b>Ask</b> <b>user</b> <b>when</b> <b>file</b> <b>op</b> <b>fails</b> – выводить запрос о полной отмене текущей операции утилиты в случае ошибки файловой системы. Такие ошибки возникают, если какие-либо файлы заняты редактирующими их программами или при проблемах с оборудованием (неработающая сеть, осыпавшиеся носители). Если пользователь соглашается, выполнение функции отменяется, и он может попробовать устранить проблему сам, иначе такие файлы просто пропускаются. Чтобы отменить изменения в сцене, пользователь может перезагрузить сцену, поскольку при отмене сцена не сохраняется. Сколько файлов и какие именно файлы скопированы во время отмененной операции утилиты, может быть установлено по логу операции.<br />
<b>Reload</b> <b>while</b> <b>fix</b> (<b>slow</b>!) – перезагружать изображения во время изменения ссылок. Перезагрузка всех изображений занимает много времени и оперативной памяти (если сцена большая и включает значительное количество ресурсов, возможно получение сообщений от Windows об увеличении объема виртуальной памяти). Часто такая перезагрузка не является необходимой. Опцию следует выбирать только в том случае, когда вы выбираете «Использовать имеющийся» при совпадении имен копируемого и уже имеющегося в папке сбора файлов, вы уверены что имеющийся отличается от копируемого, и хотите увидеть его сразу после операции сбора. На небольших сценах переписывание ссылок с этой опцией несильно замедляет процесс, однако в большинстве случаев необходимости в ее выборе нет. <br />
<br />
<b>Content</b>
Содержимое сцены<br />
<b>Process</b> <b>medit</b>-<b>only</b> <b>content</b> – собирать объекты (текстуры и материалы), присутствующие только в редакторе материалов и не примененные к объектам сцены. <br />
<b>Process</b> <b>XRef</b> <b>structure</b> – обрабатывать не только текущую сцену, но все ее XRef-дерево.<br />
<b>Clear</b> <b>medit</b> <b>before</b> <b>proceed</b> – очищать палитру редактора материалов перед операцией. Если выбрана эта опция, то опция Process <b>medit</b>-<b>only</b> <b>content</b> недоступна.<br />
<b>Ignore</b> <b>shaders</b> – игнорировать файлы с расширениями ".cgfx", ".mi", ".psh", ".vsh", ".fx", ".fxh", ".axml", ".msl". Сбрасывать опцию не рекомендуется, если только вы не используете собственные шейдеры, которые можно – и нужно – переносить с места на место (они не подгружают другие файлы).<br />
<b>Scan</b> <b>all</b> <b>tex</b> <b>instances</b> <b>also</b> – просканировать также все объекты типа TextureMap, имеющиеся в системе. Эта опция добавлена на случай, если алгоритм сбора упустит какие-либо текстуры, являющиеся частью плагинов, которые невозможно просканировать стандартным алгоритмом. Ввиду универсальности и абстрактного подхода алгоритма сбора, до настоящего времени такие текстуры найдены не были, опция добавлена на всякий случай. К сожалению, эта опция не решает проблем со материалами Maxwell Render и Fry Renderer. <br />
<br />
<b>Collect</b> <b>Roots</b><br />
Папки сбора. Кнопка с многоточием рядом запускает диалог выбора папки<br />
<b>Images</b> & <b>ph</b>.<b>web</b> <b>root</b> – папка сбора изображений (кроме HDR) и IES-файлов. В эту же папку попадают шейдеры, если не выбрана опция <b>Ignore</b> <b>shaders</b> из категории <b>Content</b><br />
<b>HDRI</b> <b>root</b> – папка сбора HDR-изображений<br />
<b>VRay</b> <b>meshes</b> <b>root</b> – папка сбора Vray-mesh’ей<br />
 <br />
<b>Affect</b><br />
На что воздействуют операции утилиты<br />
<b>Images</b> & <b>ph</b>.<b>web</b> – обрабатывать изображения и IES-файлы (также будут обработаны шейдеры, если не выбрана опция <b>Ignore</b> <b>shaders</b>)<br />
<b>HDR</b> <b>images</b> - обрабатывать HDR-изображения<br />
<b>VRay</b> <b>meshes</b> - обрабатывать VRay mesh’и<br />
<br />
<b>Resource</b> <b>roots</b> <b>related</b><br />
Операции утилиты, напрямую относящиеся к папкам сбора. В операциях участвуют ресурсы выбранных в категории <b>Affect</b> типов. Осуществляется обработка всех ссылок в текущей сцене или (если выбрана опция <b>Process</b> <b>XRef</b> <b>structure</b> из категории <b>Content</b>) всего XRef-дерева текущей сцены.<br />
<b>Collect</b> <b>resources</b> – собрать ресурсы выбранных типов в соответствующие папки из категории <b>Collect</b> <b>Roots</b><br />
<b>Unused</b> - найти в папках из категории <b>Collect</b> <b>Roots</b> ресурсы выбранных типов, на которые нет ни одной ссылки в текущей сцене или во всем XRef-дереве; если выбрана опция <b>Summary</b> <b>only</b>, то при обработке Xref-дерева окно со списком неиспользованных файлов выводится только по завершении обработки всего дерева, иначе окно выводится также после обработки каждого файла, показывая какие файлы не использованы именно текущей сценой<br />
<b>Relink</b> <b>to</b> <b>resources</b> <b>roots</b> – переписать все ссылки на ресурсы выбранных типов так, чтобы они указывали на файлы в соответствующих папках из категории <b>Collect</b> <b>Roots</b><br />
<br />
<b>Resolve</b> <b>links</b> <b>to</b> <b>existing</b> – переписать все ссылки на ресурсы выбранных в категории <b>Affect</b> типов так, чтобы они указывали на реальные файлы, если сохраненные в сцене пути указывают на несуществующие файлы, но 3dsmax обнаружил их в другом месте (см. <b>Реальный</b> <b>путь</b> <b>файла</b> в <b>Терминах</b>)<br />
<b>Missing</b> <b>files</b> <b>identity</b> – идентификация объектов, в которых присутствуют ссылки на потерянные файлы<br />
<b>Continue</b> <b>op</b> <b>after</b> <b>crash</b> – продолжить последнюю операцию, начатую для XRef-дерева, но прерванную неустранимой ошибкой 3dsmax (см. ниже – <b>Continue op after crash</b>)

</td>
</tr>

<tr>
<td width = 180>&nbsp;
</td>
<td>
<br /> <br />
<h4>Свиток «Convert to JPEG/TGA»</h4>
</td>
</tr>

<tr>
<td width = 180> <img src="img/4.gif" width="169" height="177" alt="" />
</td>
<td>
Конвертация изображений ".tif", ".tiff", ".psd", ".png", ".tga" и ".bmp" в JPEG. Если изображение содержит альфа-канал, то оно не может быть сохранено без потери альфы в JPEG, поэтому пользователю предлагаются варианты.<br />
<b>If image has alpha (ask/skip/JPG/TGA)</b> – если изображение содержит альфа-канал, то: спросить пользователя / пропустить / все равно конвертировать в JPEG (с потерей альфа-канала) / конвертировать в TGA c RLE-сжатием (сохраняется альфа-канал)<br />
<b>Premultiplied</b> <b>alpha</b> <b>in</b> <b>TGA</b> – смешивать с цвет полупрозрачных пикселей цветом фона (при сохранении в TGA)<br />
<b>JPEG</b> <b>quality</b> – качество JPEG.<br />
<b>Use</b> <b>NConvert</b>© <b>if</b> <b>exists</b> – если <b>NConvert</b>© присутствует в папке утилиты («maxroot\scripts\tocollectorex» или «maxroot\scripts\tocollectorex Demo» для демо-версии), в корневой папке 3dsmax, в папке Windows или в папке Windows\System32, то она будет использована для конвертации в JPEG (вместо стандартного компрессора 3dsmax)<br />
<b>Convert</b> – запустить операцию конвертации всех изображений сцены или XRef-дерева (опции из категории <b>Affect</b> свитка <b>TO</b> <b>CollectoREX</b> не оказывают действия на эту операцию) <br />

</td>
</tr>

<tr>
<td width = 180>&nbsp;
</td>
<td>
<br /> <br />
<h4>Свиток «Help & config»</h4>
</td>
</tr>

<tr>
<td width = 180> <img src="img/5.gif" width="165" height="179" alt="" />
</td>
<td>
Справка и настройки<br/>
Настройки автоматически сохраняются вместе со сценой и загружаются во время загрузки сцены. Кроме того они могут быть глобально сохранены в ini-файле. Такие настройки называются глобальными умолчаниями (defaults) пользователя или настройками по умолчанию. Настройки по умолчанию загружаются, если текущая сцена не содержит настроек. Также можно загрузить их принудительно или сбросить в начальные значения.<br/>
<b>Config</b> <br/>
Настройки<br/>
<b>Save</b> <b>config</b> <b>as</b> <b>defaults</b> – сохранить текущие настройки как значения по умолчанию<br/>
<b>Load</b> <b>config</b> <b>from</b> <b>defaults</b> – загрузить настройки из значений по умолчанию<br/>
<b>Clear</b> <b>defaults</b> – сбросить настройки по умолчанию в исходные значения<br/>
<br/>
<b>About</b> – запустить браузер с файлом справки<br/>
<b>License</b> <b>search</b>/<b>request</b> (в демо-версии – <b>How</b> <b>to</b> <b>buy</b>) – произвести поиск подходящей лицензии в папке утилиты («maxroot\scripts\tocollectorex»), в корневой папке 3dsmax, в папке Windows или в папке Windows\System32. В демо-версии эту кнопку заменяет кнопка <b>How</b> <b>to</b> <b>buy</b>, которая выводит краткую информации о получении полной версии.
</td>
</tr>
</table>

<h2>Подробное описание функций утилиты</h2>
<h3>Функции, работающие с папками сбора</h3>
Все функции выводят подробную информацию о своих действиях – в файл лога и в консоль MAXScript Listener. Чтобы увидеть её, нажмите F11 или щелкните по пункту меню MAXScript-> MAXScript Listener. <br/>
Прогресс каждого этапа операции (и его название) отображается индикатором прогресса в нижней части окна 3dsmax. Каждая из операций может быть прервана на любом этапе нажатием кнопки <b>Cancel</b> индикатора прогресса или клавишей ESC.<br/>
<h4>Collect resources</h4>
Эта операция включает в себя:<br/>
- выбор пользователем папок сбора<br/>
- резервное сохранение файла сцены<br/>
- сбор информации о ссылках<br/>
- вывод карты реального расположения файлов, использованных в сцене<br/>
- поиск и вывод ненайденных файлов и полного дерева каждого объекта, ссылающегося на этот файл<br/>
- копирование файлов в папки сбора<br/>
- переписывание ссылок<br/>
- сохранение файла сцены<br/>
<br/>
<b>Папки</b> <b>сбора</b><br/>
Папки сбора могут совпадать. Одна и та же папка сбора может быть указана для нескольких проектов (например, для хранения больших Vray mesh). В этом случае функция утилиты <b>Unused</b> должна быть использована с осторожностью – будут показаны файлы, которые не используются только текущей сценой или ее XRef-деревом. Например, если несколько проектов используют каждый свою папку сбора для изображений, но одну и ту же папку для сбора Vray mesh’ей, то при использовании функции <b>Unused</b> на любом из этих проектов при выбранной опции <b>VRay</b> <b>meshes</b> категории <b>Affect</b> главного свитка утилита покажет не используемые только текущим проектом.<br/>
<br/>
<b>Резервное</b> <b>сохранение</b> <br/>
Утилита позволяет осуществлять резервное сохранение. При этом возможны два варианта: инкрементное (по умолчанию) и обычное. При инкрементном имя backup-файла будет состоять из имени оригинального файла, порядкового номера (если это не первое резервное сохранение для этого файла) и двойного расширения «max.backup». При обычном – в имя не включается порядковый номер, и, если файл с таким именем уже есть, он перезаписывается поверх.<br/>
<br/>
<b>Сбор</b> <b>информации</b> <b>о</b> <b>ссылках</b><br/>
Утилита просматривает следующие сущности 3dsmax: <br/>
- геометрию <br/>
- источники света <br/>
- пространственные ловушки <br/>
- вспомогательные объекты<br/>
- плоские фигуры <br/>
- текстуры, назначенные рендереру (например, карта среды VRay)<br/>
- карту среды 3dsmax <br/>
- эффекты <br/>
- эффекты атмосферы<br/>
- все объекты родительского типа для всех текстур в системе (если выбрана опция <b>Scan</b> <b>all</b> <b>tex</b> <b>instances</b> <b>also</b> категории <b>Content</b> главного свитка)<br/>
- все материалы и карты, содержащиеся в Material Editor и не примененные к объектам сцены (если выбрана опция <b>Process</b> <b>medit</b>-<b>only</b> <b>content</b> <b>also</b> категории <b>Content</b> главного свитка)<br/>
В сущностях утилита ищет изображения, IES-файлы, HDRI и VRay mesh’и – смотря, какие выбраны опции в категории <b>Affect</b> главного свитка<br/>
<br/>
<b>Карта</b> <b>реального</b> <b>расположения</b> <b>файлов</b><br/>
См. <b>Термины</b>: <b>Реальный</b> <b>путь</b> <b>файла</b>. Утилита выводит в лог пути в формате «сохраненный в сцене путь» -> «реально найденный путь». Если файл не найден, то вместо реально найденного пути будет служебное слово «missing». При выводе повторения не учитываются – любой файл будет показан только один раз.<br/>
<br/>
<b>Сбор</b>: <b>копирование</b> <b>файлов</b> <b>в</b> <b>папки</b> <b>сбора</b>. <b>Файлы</b> <b>с</b> <b>совпадающими</b> <b>именами</b><br/>
Если при копировании файлов в папки сбора обнаруживается, что файл с таким именем уже есть, то утилита пытается сравнить файлы. Изображения она сравнивает полностью (с альфой и без), у прочих файлов вычисляет контрольную сумму алгоритмом HMACSHA512. При желании можно использовать полное побайтное сравнение у таких файлов, но оно занимает слишком много времени, а сравнение контрольных сумм в большинстве случаев гарантирует, что файлы одинаковы. При идентичности файлов с одинаковыми именами ссылки переписываются так, что они указывают на существующий в папке сбора (это поведение может быть изменено с помощью опций <b>Ask</b> <b>even</b> <b>if</b> <b>bmps</b> <b>are</b> <b>equal</b> и <b>Ask</b> <b>even</b> <b>if</b> <b>binary</b> <b>are</b> <b>equal</b>). <br/>
При совпадении имен копируемого и имеющегося файлов, если файлы неодинаковы (или выбрана одна или обе опции <b>Ask</b> <b>even</b> <b>if</b> <b>bmps</b> <b>are</b> <b>equal</b> и <b>Ask</b> <b>even</b> <b>if</b> <b>binary</b> <b>are</b> <b>equal</b>) пользователю выводится окно сравнения, чтобы он мог правильнее принять решение. Он может: заменить копируемым файлом имеющийся, использовать имеющийся, или переименовать (соответственно, кнопки <b>Replace</b>, <b>Use</b> <b>Existing</b>, <b>Raname</b> <b>to</b>…). Имя файла для переименования, уникальное для папки сбора, подставляется в окно сравнения. При желании его можно изменить, но утилита не даст задать имя, неуникальное для папки сбора. В окне сравнения между миниатюрами ставятся знаки равенства (==) или неравенства (<>) – это результаты сравнения изображений без учета альфа-канала (rgb) и с учетом (rgba). Под изображениями приводится информация о файлах: если это изображения, то разрешение, размер, наличие дополнительных каналов (для RLA) и альфа-канала. Для файлов, не являющихся изображениями, выводится только размер. Ниже указывается исходный путь к файлу до сбора. <br/>
При желании пользователь может отменить операцию сбора на этом этапе, нажав кнопку <b>ABORT</b> <b>COLLECT</b>. <br/> <br />
<center><img src="img/6.gif" width="914" height="594" alt="" /></center><br />  <br />
<b>Переписывание</b> <b>ссылок</b> <b>в</b> <b>сцене</b><br/>
После завершения копирования утилита перебирает все объекты, в которых были найдены ссылки на файлы и переписывает их новыми значениями. При этом, если выбрана опция <b>Reload</b> <b>while</b> <b>fix</b> (<b>slow</b>!) категории <b>Security</b> главного свитка, утилита может перезагружать изображения. Как правило, это не требуется. Однако если известно, что при совпадении имен будут использованы уже имеющиеся в папках сбора файлы изображений, и они явно отличаются от тех, что копируются, можно выбрать эту опцию.<br/>

<h4>Unused</h4>
Эту функцию надо использовать уже после того, как сцена прошла процесс сбора. <b>Unused</b> позволяет определить, какие файлы в папках сбора не используются текущим проектом. Функция включает в себя:<br/>
- выбор пользователем папок сбора<br/>
- сбор информации о ссылках<br/>
- показ таблицы неиспользуемых файлов<br/>
<br/>
<b>Таблица</b> <b>неиспользуемых</b> <b>файлов</b><br/>
<br/>            <br />
 <center><img src="img/7.gif" width="804" height="591" alt="" /></center>    <br />
<br/>
В этой таблице отображаются не используемые сценой файлы. Для удобства приведена информация о размере и дате последнего изменения каждого файла. Напротив каждого файла слева находится флажок. Операции Kill checked и Checked to trash относятся к тем файлам, у которых этот флажок не сброшен.<br/>
Пользователь может удалить файлы или переместить в локальную корзину. Локальная корзина – это папка $<b>trash</b>$, создающаяся в папке, в которой найдены неиспользуемые файлы, когда пользователь решает переместить их в локальную корзину.<br/>
Кнопки окна:<br/>
<b>Kill</b> <b>checked</b> – удалить файлы, флажок которых не сброшен<br/>
<b>Kill</b> <b>all</b> – удалить все файлы<br/>
<b>Checked</b> <b>to</b> <b>trash</b> – переместить в локальную корзину файлы, флажок которых не сброшен<br/>
<b>All</b> <b>to</b> <b>trash</b> – переместить все файлы в локальную корзину<br/>
<b>Checkers</b>: <b>Invert</b> – инвертировать флажки<br/>
<b>Checkers</b>: <b>None</b> – сбросить все флажки<br/>
<b>Checkers</b>: <b>All</b> – установить все флажки<br/>
<b>Checkers</b>: <b>Selected</b> <b>on</b> – установить флажки у выделенных строк (несколько строк можно выделить, придерживая CTRL или SHIFT)<br/>
<b>Checkers</b>: <b>Selected</b> <b>off</b> – сбросить флажки у выделенных строк<br/>
Двойной щелчок мыши по строке открывает изображение в VFB (virtual frame buffer). Каждый раз создается новое окно VFB, следует не забывать закрывать эти окна вручную, чтобы не расходовать память попусту.<br/>
<h4>Relink to resources roots</h4>
Эта функция применяется в следующей ситуации: проект прошел процесс сбора, после этого папки сбора (или папки сбора и проект) были перенесены в другое место: другой диск или другой компьютер. Внимание: если просто файл проекта (сцены или нескольких связанных сцен) перемещен, данная операция не требуется. Дело в том, что при изменении местоположения папок сбора все ссылки проекта будут указывать на несуществующие файлы. <br/>
Возможна ситуация, когда эти файлы не попадут в категорию потерянных (missing files). Это возможно, если папки сбора перенесены куда-нибудь внутрь папки проекта (имеется ввиду в саму папку или в любую ее подпапку с любой степенью вложенности) или внутрь папки, содержащейся в путях, которые «видит» 3dsmax (например, user paths). Однако даже в такой ситуации, если все оставить как есть, то при попытке сделать из этой сцены в другую merge потерянные файлы все-таки появятся. <br/>
Данная функция изменяет все ссылки так, чтобы они указывали на файлы с теми же именами, но находящиеся внутри указанных папок сбора (если ранее указанные папки не существуют, то при загрузке настроек утилиты из сцены соответствующие поля будут очищены).<br/>
<br/>
Операция включает в себя:<br/>
- выбор пользователем папок сбора<br/>
- резервное сохранение файла сцены<br/>
- сбор информации о ссылках<br/>
- вывод карты реального расположения файлов, использованных в сцене<br/>
- поиск и вывод ненайденных файлов и полного дерева каждого объекта, ссылающегося на этот файл<br/>
- переписывание ссылок<br/>
- сохранение файла сцены<br/>
<h3>Прочие функции</h3>
Следующие три функции не связаны с папками сбора и могут применяться на сцене, не прошедшей процесса сбора.<br/>
<h4>Resolve links to existing</h4>
Эта функция переписывает ссылки так, чтобы они указывали на реальные файлы. Она может работать в обход методики сбора и параллельно с ней. <br/>
Она включает в себя:<br/>
- резервное сохранение файла сцены<br/>
- сбор информации о ссылках<br/>
- вывод карты реального расположения файлов, использованных в сцене<br/>
- поиск и вывод ненайденных файлов и полного дерева каждого объекта, ссылающегося на этот файл<br/>
- переписывание ссылок<br/>
- сохранение файла сцены<br/>
<h4>Missing files Identity</h4>
Эту функция просто показывает, какие объекты включают ссылки на потерянные файлы, с выводом полного дерева ссылок. <br/>
Она включает в себя:<br/>
- сбор информации о ссылках<br/>
- вывод карты реального расположения файлов, использованных в сцене<br/>
- поиск и вывод ненайденных файлов и полного дерева каждого объекта, ссылающегося на этот файл<br/>
<h4>Convert to JPEG/TGA</h4>
Эта функция конвертирует ".tif", ".tiff", ".psd", ".png", ".tga" и ".bmp" в JPEG. ВНИМАНИЕ: опции категории <b>Affect</b> не действуют на данную функцию. <br/>
Если изображение содержит альфа-канал, то оно не может быть сохранено без потери альфы в JPEG, поэтому пользователю предлагаются варианты: конвертировать в JPEG, сохранить как TGA (если это не TGA-файл) или оставить без изменений. Действие по умолчанию можно выбрать в категории <b>If</b> <b>image</b> <b>has</b> <b>alpha</b> свитка <b>Convert</b> <b>to</b> <b>JPEG</b>/<b>TGA</b>. <br/>
Когда утилита встречает изображение, имеющее альфа-канал, она выводит окно, в котором находится миниатюра этого изображения, информация о его разрешении и размере, дополнительных каналах. <br/>
Ниже показаны два варианта окна (на левом изображение уже имеет формат TGA).<br/>
<br/>                <br />
  <center><img src="img/8.gif" width="910" height="620" alt="" /> </center> <br />
<br/>
Кнопки окна:<br/>
<b>Convert</b> <b>to</b> <b>JPEG</b> – конвертировать в JPEG с потерей данных альфа-канала<br/>
<b>Don’t</b> <b>convert</b> – оставить без изменений<br/>
<b>Convert</b> <b>to</b> <b>TGA</b> – конвертировать изображение в формат TGA с RLE-компрессией, если опция <b>PreMultAlpha</b> выбрана, то с цвет полупрозрачных пикселей будет смешан с цветом фона; установлена ли эта опция при каждом открытии диалога, зависит от состояния опции <b>Premultiplied</b> <b>alpha</b> <b>in</b> <b>TGA</b> свитка <b>Convert</b> <b>to</b> <b>JPEG</b>/<b>TGA</b>. <br/>

<h2>Работа с XRef-деревом </h2>
Если сцена содержит XRef-ссылки (XRef Scenes, XRef Objects, XRef Materials и XRef Atmospherics), то при выбранной опции <b>Process</b> <b>XRef</b> <b>structure</b> категории <b>Content</b> главного свитка утилита может обработать все сцены, связанные с текущей посредством этих ссылок.<br/>
С XRef-деревом может работать любая функция утилиты. Тогда при запуске функции выводится окно, демонстрирующее XRef-дерево сцен. Отступами показана глубина вложенности.<br/>
<br/>
Поиск сцен, входящих в XRef-дерево, ведется:<br/>
- в XRef Scenes и включенные в них сцены и т.д.; граф может быть зациклен, в построенном утилитой списке не будет дубликатов <br/>
- в объектах сцены, которые имеют тип XRefObject; если содержащийся в этом объекте объект имеет тип XRefObject (сквозное включение), то поиск идет до такой степени вложенности, где базовый объект – не XRefObject<br/>
- в прокси XRef-объектов сцены <br/>
- в материалах сцены и, если надо (опция <b>Process</b> <b>medit</b>-<b>only</b> <b>content</b> категории <b>Content</b> главного свитка), в материалах Material Editor, не примененных к объектам сцены – так же до необходимой глубины вложенности<br/>
- в эффектах атмосферы, импортированных из других сцен посредством XRef-ссылки - так же до необходимой глубины вложенности<br/>
<br/>           <br />
<center><img src="img/9.gif" width="559" height="299" alt="" /> </center>       <br />
<br/>
В нижнем левом углу показано название текущей операции.<br/>
Кнопки окна:<br/>
<b>Abort</b> <b>operation</b> – отменить операцию<br/>
<b>Continue</b> <b>without</b> <b>XRef</b> <b>tree</b> – продолжить только с текущей сценой<br/>
<b>Continue</b> – продолжить с полной обработкой всего XRef-дерева<br/>
При обработке всего XRef-дерева, 3dsmax загружает, обрабатывает и сохраняет, если это необходимо, все файлы, входящие в дерево. Обработка каждого файла происходит, как описано выше. Особенностью является лишь то, что ко всем сценам в процессе обработки применяются одни и те же настройки утилиты, в том числе и пути папок сбора. <br/>
<h3>Continue op after crash</h3>
Поскольку критические сбои 3dsmax достаточно часты, в частности – при загрузке-выгрузке больших файлов, возможна ситуация, когда происходит критический сбой в процессе обработка длинного списка файлов. Для того, чтобы продолжить начатую операцию после перезагрузки 3dsmax (необходимо убедиться, что после закрытия окна 3dsmax его процесс также закрылся), предназначена функция <b>Continue</b> <b>op</b> <b>after</b> <b>crash</b>.<br/>
После перезапуска 3dsmax, если предыдущая операция была прервана критическим сбоем или действиями пользователя, кнопка <b>Continue</b> <b>op</b> <b>after</b> <b>crash</b> главного свитка находится в разрешенном состоянии. При нажатии ее пользователь видит окно <b>Continue</b> <b>After</b> <b>Crash</b>. В окне отображены настройки, с которыми была запущена операция, название операции (в нижнем левом углу) и список файлов, которые еще не обработаны (Files scheduled).<br/>
<br/>                           <br />
 <center><img src="img/10.gif" width="509" height="492" alt="" /></center> <br />
<br/>
Кнопки окна: <br/>
<b>Cancel</b> – просто закрыть окно: на случай, если пользователь просто захотел посмотреть, что содержится в файле информации для <b>Continue</b> <b>op</b> <b>after</b> <b>crash</b> <br/>
<b>Abort</b> <b>operation</b> – отменить прерванную операцию и удалить все данные о ней<br/>
<b>Continue</b> – продолжить прерванную операцию<br/>
<br/>
В процессе обработки XRef-дерева в batch-режиме после каждого файла сохраняется текущее состояние операции, чтобы в случае сбоя было возможно продолжение. При успешном завершении операции такой файл стирается. Файл, в котором хранится информация для <b>Continue</b> <b>op</b> <b>after</b> <b>crash</b>, имеет имя «TOCollectoREX_cac.ini» и находится в папке настроек плагинов 3dsmax: если ввести в MAXScript Listener строку symbolicPaths.getPathValue "$plugcfg" и нажать ENTER, MAXScript покажет, где находится эта папка, например:<br/>
"С:\Documents and Settings\Administrator\Local Settings\Application Data\Autodesk\3dsmax\2008 - 64bit\enu\plugcfg".<br/>
Не рекомендуется его редактировать вручную, утилита сама удалит его, когда он станет не нужен. <br/>
<h2>Настройки утилиты  </h2>
Для удобства настройки утилиты сохраняются отдельно в каждой сцене, например, чтобы при следующей операции сбора не задавать вновь папки сбора и не выбирать необходимые опции. Если в сцене еще не сохранены настройки утилиты, вписываются настройки по умолчанию (они приведены в таблице описания интерфейса). <br/>
Для того, чтобы настроить утилиту «под себя», предусмотрены изменение этих умолчаний. «Умолчания пользователя» сохраняются в файле с именем «TOCollectoREX_defaults.ini», находящемся в папке настроек плагинов 3dsmax (см. выше).  С помощью кнопок категории <b>Config</b> свитка <b>Help</b> & <b>Config</b> пользователь может сохранить настройки из текущей сцены как умолчания, загрузить настройки из умолчаний, сбросить умолчания в исходное состояние.<br/>
<br/>
<h2>Типичная схема работы с утилитой (workflow)</h2>
Пользователь создает сцену, подключает к ней различные ресурсы и редактирует ее. После завершения каждого этапа (если его работа подразумевает деление на этапы) или просто периодически пользователь использует функцию утилиты <b>Collect</b> <b>resources</b>. По мере надобности (например, по факту завершения разработки сложных текстур в Adobe Photoshop) он использует <b>Convert</b> <b>to</b> <b>JPEG</b>/<b>TGA</b> и время от времени – <b>Unused</b>, чтобы установить, какие ресурсы больше не нужны, и их можно удалить. Если в сцену добавляются объекты из других сцен, пользователь может использовать <b>Resolve</b> <b>links</b> <b>to</b> <b>existing</b>, чтобы установить, какие реально существующие ресурсы загружаются в импортированный кусок сцены. Если какие-то файлы выводятся в списке Missing Files при загрузке сцены, можно использовать <b>Missing</b> <b>Files</b> <b>Identity</b>, чтобы установить, какие именно объекты включают потерянные файлы и устранить проблему. <br/>
Та же схема работы, если сцена использует XRef-ссылки, но возможно использование <b>Continue</b> <b>op</b> <b>after</b> <b>crash</b> при сбоях 3dsmax.<br/>
Для удобства пользователь может сохранить конфигурацию утилиты как глобальные умолчания (например, если он предпочитает обычное резервное сохранение инкрементному или не желает, чтобы Material Editor очищался с выполнением каждой операции утилиты).<br/>

<h2>Отказ от пользования утилитой</h2>
Пользование утилитой или отказ от нее не налагает никаких ограничений на ваш технологический процесс. Если вы откажетесь от ее использования и удалите ее из системы, никакие данные не будут потеряны, ваши сцены, обработанные утилитой, будут продолжать открываться и сохраняться, как прежде. То же относится и к файлам ресурсов, собранных или конвертированных с помощью утилиты.<br/>

<h2>Известные проблемы и решения</h2>
1. Если вы используете displace space warp, и в нем используете поле bitmap, и собираетесь сделать Relink To Resources Roots (а в настоящее время все файлы сцены имеют статус Missing), то есть вероятность, что эта картинка не будет перелинкована на новый путь. Поэтому советуем использовать в displace space warp параметр Map вместо Bitmap<br />
2. Если во время операции Find Unused Files по X-Ref дереву произойдет сбой 3dsmax, то при восстановлении (Continue op after crash) будет показан суммарный список файлов, не используемых только теми сценами, которые обрабатывались после сбоя. Попробуйте перезапустить 3dsmax и повторить операцию<br />
3. Утилита пользуется возможностями Microsoft .NET, а связка MaxScript-.NET несовершенна, поэтому периодически могут не отрисовываться некоторые элементы управления. Достаточно пощелкать по этим элементам или переключиться на другую задачу, а потом обратно в 3dsmax, чтобы они отрисовались.<br />
4. При длительной работе утилиты возможны странности в работе 3dsmax. Обычно этому предшествует вывод одного или нескольких диалогов 3dsmax, сообщающих что в работе сборщика мусора MAXScript произошел сбой. В этом случае перезапустите 3dsmax и проследите чтобы его процесс был снят после закрытия его окна. Лучше всего запускать утилиту в "свежезапущенном" 3dsmax.<br />
5. IFL - если имена файлов не относительные, то в результате сбора ссылаться IFL будет все равно на то место, куда указывают пути, только если файлы там присутствуют. Рекомендуется создавать IFL-файлы, не используя абсолютный путь - в каждой строке должно быть только имя файла (вариант по умолчанию)<br />
6. Утилита копирует файлы шейдеров, однако указанные в них файлы она копировать не может. Опция "don't copy shaders" позволяет не собирать файлы шейдеров. Положение по умолчанию - включено.<br />
<br /><br /><br />
Tertium Organum ® 2008-2019
</body>

</html>
